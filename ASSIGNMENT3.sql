CREATE DATABASE ASSIGNMENT3;
GO

USE ASSIGNMENT3;
GO

CREATE TABLE EMPLOYEE(
EmpNo int primary key NOT NULL,
EmpName varchar(20) NOT NULL,
BirthDay DATE NOT NULL,
DeptNo int NOT NULL,
MgrNo int NOT NULL,
StartDate date NOT NULL,
Salary money NOT NULL,
[Level] int NOT NULL, CHECK ([Level] BETWEEN 1 AND 7),
[Status] int NOT NULL,
Note nvarchar(100)
)

CREATE TABLE SKILL(
SkillNo int primary key IDENTITY(1,1) NOT NULL,
SkillName varchar(10) NOT NULL,
Note nvarchar(50)
)

CREATE TABLE EMP_SKILL(
SkillNo int foreign key REFERENCES SKILL(SkillNo) NOT NULL,
EmpNo int foreign key REFERENCES EMPLOYEE(EmpNo) NOT NULL,
SkillLevel int NOT NULL , CHECK([SkillLevel] BETWEEN 1 AND 3) ,
RegDate date NOT NULL,
[Description] nvarchar(50),
CONSTRAINT PK_PersonalSkill PRIMARY KEY (SkillNo,EmpNo)
)

CREATE TABLE DEPARTMENT(
DeptNo int PRIMARY KEY IDENTITY(1,1) NOT NULL,
DeptName varchar(10) NOT NULL,
Note nvarchar(50)
)


-----------------Q2---------------
ALTER TABLE EMPLOYEE 
ADD Email varchar(20) UNIQUE;
GO

ALTER TABLE EMPLOYEE
DROP COLUMN Email

ALTER TABLE EMPLOYEE
ADD CONSTRAINT df_MgrNo
DEFAULT '0' FOR MgrNo;

ALTER TABLE EMPLOYEE
ADD CONSTRAINT df_Stt
DEFAULT '0' FOR [Status];
-----------------Q3---------------
ALTER TABLE EMPLOYEE
ADD CONSTRAINT fk_EmpDept
FOREIGN KEY (DeptNo) REFERENCES DEPARTMENT(DeptNo);

ALTER TABLE EMP_SKILL
DROP COLUMN [Description];
-----------------Q4---------------
INSERT INTO DEPARTMENT VALUES('A', 'a')
INSERT INTO DEPARTMENT VALUES('B', 'a')
INSERT INTO DEPARTMENT VALUES('C', 'a')
INSERT INTO DEPARTMENT VALUES('D', 'a')
INSERT INTO DEPARTMENT VALUES('E', 'a')

INSERT INTO EMPLOYEE VALUES(145601, 'ABCD1', '01-02-1993', 1,1,'01-02-2014',1000000,1,0,'','1@gmal.com')
INSERT INTO EMPLOYEE VALUES(101015, 'ABCD2', '01-02-1994', 2,2,'07-04-2016',1000000,2,0,'','2@gmal.com')
INSERT INTO EMPLOYEE VALUES(112120, 'ABCD3', '01-02-1995', 3,5,'08-23-2015',1000000,3,0,'','3@gmal.com')
INSERT INTO EMPLOYEE VALUES(112012, 'ABCD4', '01-02-1998', 4,6,'10-07-2017',1000000,5,1,'','4@gmal.com')
INSERT INTO EMPLOYEE VALUES(145452, 'ABCD5', '01-02-1998', 5,7,'01-15-2018',1000000,6,2,'','5@gmal.com')

INSERT INTO SKILL VALUES('A','')
INSERT INTO SKILL VALUES('B','')
INSERT INTO SKILL VALUES('C','')
INSERT INTO SKILL VALUES('D','')
INSERT INTO SKILL VALUES('E','')

INSERT INTO EMP_SKILL VALUES(1,145601,'1','01-14-2013')
INSERT INTO EMP_SKILL VALUES(2,101015,'2','05-07-2014')
INSERT INTO EMP_SKILL VALUES(3,112120,'3','04-21-2015')
INSERT INTO EMP_SKILL VALUES(4,112012,'1','03-11-2016')
INSERT INTO EMP_SKILL VALUES(5,145452,'2','01-03-2017')

CREATE VIEW EMPLOYEE_TRACKING AS
SELECT EMPLOYEE.EmpNo, EMPLOYEE.EmpName, EMPLOYEE.[Level]
FROM EMPLOYEE
WHERE [Level] BETWEEN 3 AND 5

SELECT * from EMPLOYEE_TRACKING